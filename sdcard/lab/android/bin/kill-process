#!/system/xbin/bash

# Kill a process along with children
# 
# Author: Seff P
# Version: 20200704

source set-color

if [[ -s "$2" ]]
    then
    PID=$(cat $2)
    PID_FILE=$2
else
    PID=$2
fi

PNAME=$1

if [[ ! -z $PID ]]
    then
    if pgrep -f $PNAME | grep -wq "^${PID}$"
        then
        if ! [[ "$3" == "check-only" ]]
            then
            # stopping along with children
            busybox pkill -9 -P $PID &> /dev/null 
            kill -9 $PID &> /dev/null
            rm -f $PID_FILE
        fi
        # matched, but not killed
        EXIT=0
    else
        # PID and PNAME not matched
        EXIT=2
    fi
else
    # No PID is given
    EXIT=1
fi

exit $EXIT